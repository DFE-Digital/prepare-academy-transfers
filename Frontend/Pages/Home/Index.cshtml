@page "/home"
@model Frontend.Pages.Home.Index


@{
    ViewBag.Title = "Home";
    Layout = "_Layout";
}

@section BeforeMain
{
    <a asp-page="@Links.ProjectType.Index.PageName" class="govuk-back-link" data-cy="select-backlink">@Links.ProjectType.Index.BackText</a>
}

<div class="govuk-grid-row govuk-!-margin-bottom-9">
    <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-xl" data-cy="select-heading">
            Manage an academy transfer
        </h1>
        <p class="govuk-body-l">
            Use this service to start a new academy transfer project or update an existing project.
        </p>
        <a asp-page="/Transfers/TrustName" role="button" draggable="false" 
           class="govuk-button govuk-button--start" data-module="govuk-button" data-test="create-transfer">
            Start a new transfer project
            <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19" viewBox="0 0 33 40" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z"></path>
            </svg>
        </a>
    </div>
</div>
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
       <h2 class="govuk-heading-l">
          Projects
       </h2>
       
       <details class="govuk-details prepare-project-listing__filters-container" data-module="govuk-details" @(Model.IsFiltered ? "open" : null )>
          <summary class="govuk-details__summary prepare-project-listing__fitlers-details-summary">
             <span class="govuk-details__summary-text govuk-button govuk-button--secondary prepare-project-listing__button--main">
                Filter projects
             </span>
          </summary>
          <div class="govuk-details__text prepare-project-listing__filters-details">
             <form method="get" class="form">
                <div class="govuk-grid-row">
                   <div class="govuk-grid-column-one-quarter">
                      <div class="govuk-form-group">
                         <h1 class="govuk-label-wrapper">
                            <label class="govuk-label govuk-label--s" for="filter-project-title">
                               Project title
                            </label>
                         </h1>

                         <div id="filter-project-title-hint" class="govuk-hint">
                            For example, The Rutland Learning Trust
                         </div>

                           <input asp-for="TitleFilter" class="govuk-input" type="text" aria-describedby="filter-project-title-hint">
                      </div>
                   </div>
                </div>

                <div class="govuk-grid-row">
                   <div class="govuk-grid-column-full">
                      <div class="govuk-button-group">
                         <button class="govuk-button govuk-button--secondary prepare-project-listing__button--apply" data-module="govuk-button ">
                            Apply filters
                         </button>

                         <a class="govuk-link" href="/home">Clear filters</a>
                      </div>
                   </div>
                </div>
             </form>
          </div>
       </details>

       <table class="govuk-table">
            <caption class="govuk-table__caption govuk-table__caption--m govuk-visually-hidden">Projects (@Model.Projects.Count)</caption>
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th class="govuk-table__header app-!-width-three-fifths">Application information</th>
                    <th class="govuk-table__header govuk-!-text-align-right app-!-width-two-fifths prepare-text-align-right">Project status</th>
                </tr>
            </thead>
            <tbody class="govuk-table__body">
                @foreach (var project in Model.Projects.Where(p => p.TransferringAcademies.Any()))
                {
                    var firstOutgoingAcademy = project.TransferringAcademies.First();
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell">
                            <h2 class="govuk-caption-l govuk-!-margin-bottom-0 govuk-!-margin-top-1">
                                <strong>
                                    <a data-id="project-link-@project.Urn" class="govuk-link" asp-page="/Projects/Index" asp-route-urn="@project.Urn">
                                        @firstOutgoingAcademy.IncomingTrustNameInTitleCase
                                    </a>
                                </strong>
                                <span>
                                    UKPRN @firstOutgoingAcademy.IncomingTrustUkprn
                                </span>
                            </h2>
                            <p class="govuk-!-margin-top-3">
                                <div>Project reference: @project.Reference</div>
                                <div>Outgoing trust: @project.OutgoingTrustNameInTitleCase</div>
                            </p>
                        </td>
                        <td class="govuk-table__cell govuk-table__cell prepare-text-align-right">
                            <p class="govuk-!-margin-top-0">
                                <strong class="govuk-tag govuk-tag--yellow">PRE ADVISORY BOARD</strong>
                            </p>
                        </td>
                    </tr>
                }
            </tbody>
        </table>


            @*@foreach (var project in Model.Projects.Where(p => p.TransferringAcademies.Any()))
            {
                var firstOutgoingAcademy = project.TransferringAcademies.First();

                <div class="dfe-application-card">
                    <div class="dfe-application-card--project-info">
                        <h3 class="govuk-heading-m">
                            <a class="govuk-link govuk-link--no-visited-state govuk-!-margin-right-1" asp-page="/Projects/Index" asp-route-urn="@project.Urn">
                                @firstOutgoingAcademy.IncomingTrustNameInTitleCase
                            </a>
                            <span class="govuk-caption-m govuk-!-display-inline">
                                UKPRN @firstOutgoingAcademy.IncomingTrustUkprn
                            </span>
                        </h3>
                        <p class="govuk-body govuk-!-margin-bottom-1">
                            Project reference: @project.Reference
                        </p>
                        <p class="govuk-body">
                            Outgoing trust: @project.OutgoingTrustNameInTitleCase
                        </p>
                    </div>
                </div>
            }*@
            <nav class="moj-pagination" id="pagination-label">
                <p class="govuk-visually-hidden" aria-labelledby="pagination-label">Pagination navigation</p>
                <ul class="moj-pagination__list">
                    @if (Model.HasPreviousPage)
                    {
                        <li class="moj-pagination__item  moj-pagination__item--prev">
                            <a class="moj-pagination__link" asp-page="/Home/Index" asp-route-currentPage="@Model.PreviousPage">Previous<span class="govuk-visually-hidden"> set of pages</span></a>
                        </li>
                        @for (var i = Model.StartingPage; i < Model.CurrentPage; i++)
                        {
                            <li class="moj-pagination__item">
                                <a asp-page="/Home/Index" asp-route-currentPage="@i" class="moj-pagination__link">@i</a>
                            </li>
                        }
                    }
                    <li class="moj-pagination__item moj-pagination__item--active">@Model.CurrentPage</li>
                    @if (Model.HasNextPage)
                    {
                        <li class="moj-pagination__item">
                            <a asp-page="/Home/Index" asp-route-currentPage="@Model.NextPage" class="moj-pagination__link">@Model.NextPage</a>
                        </li>
                        <li class="moj-pagination__item  moj-pagination__item--next">
                            <a class="moj-pagination__link" asp-page="/Home/Index" asp-route-currentPage="@Model.NextPage">Next<span class="govuk-visually-hidden"> set of pages</span></a>
                        </li>
                    }
                </ul>
                <p class="moj-pagination__results"></p>
            </nav>
    </div>
</div>
